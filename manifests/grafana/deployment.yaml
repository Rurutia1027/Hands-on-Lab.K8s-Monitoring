apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana 
  namespace: metrics
  labels: 
    app: grafana
spec:
  replicas: 1
  selector:
    matchLabels: 
      app: grafana 
  template: 
    metadata:
      labels:
        app: grafana
    spec: 
      serviceAccountName: grafana
      containers:
        - name: grafana 
          image: grafana/grafana:11.0.0
          ports: 
            - name: http
              containerPort: 3000
          env: 
            - name: GF_SECURITY_ADMIN_USER
              value: admin 
            - name: GF_SECURITY_ADMIN_PASSWORD 
              value: admin 
            - name: GF_PATHS_PROVISIONING
              value: /etc/grafana/provisioning
          readinessProbe: 
            httpGet: 
              path: /api/health
              port: 3000 
            initialDelaySeconds: 10 
            periodSeconds: 5
          livenessProbe:
            httpGet: 
              path: /api/health 
              port: 3000
            initialDelaySeconds: 30
            periodSeconds: 10
          volumeMounts: 
            - name: grafana-data
              mountPath: /var/lib/grafana
      volumes: 
        - name: grafana-data
          persistentVolumeClaim:
            claimName: grafana-data
              
